<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Special Question ðŸ’•</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  overflow-x: hidden;
}

.container {
  background: rgba(255, 255, 255, 0.15);
  -webkit-backdrop-filter: blur(15px); /* Safari */
  backdrop-filter: blur(15px);
  border-radius: 25px;
  padding: 3rem;
  text-align: center;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  max-width: 500px;
  width: 90%;
  transition: all 0.5s ease;
  position: relative;
}

.step { display: none; animation: fadeInUp 0.6s ease-out; }
.step.active { display: block; }

@keyframes fadeInUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-15px); }
  60% { transform: translateY(-7px); }
}

@keyframes heartbeat {
  0% { transform: scale(1); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.question { font-size: 1.6rem; margin-bottom: 2rem; font-weight: 300; line-height: 1.4; }

.response-text {
  font-size: 2rem; margin-bottom: 2rem; font-weight: 400;
  animation: bounce 1s ease;
  color: #ffeb3b;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
}

.input-container { margin-bottom: 2rem; }

input[type="text"], input[type="datetime-local"] {
  width: 100%; padding: 1.2rem; border: none; border-radius: 15px;
  font-size: 1.1rem; text-align: center; background: rgba(255, 255, 255, 0.9);
  color: #333; outline: none; transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}
input[type="text"]:focus, input[type="datetime-local"]:focus {
  transform: scale(1.02);
  box-shadow: 0 0 25px rgba(255, 255, 255, 0.4);
}

.btn {
  background: linear-gradient(45deg, #ff6b6b, #ee5a6f);
  border: none; padding: 1.2rem 2.5rem; border-radius: 30px;
  color: white; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease;
  margin: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 1px;
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
}
.btn:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(255, 107, 107, 0.4); }

.btn.yes { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
.btn.no { background: linear-gradient(45deg, #ff9a9e, #fecfef); }
.btn.location { background: linear-gradient(45deg, #a8edea, #fed6e3); color: #333; }

.heart { font-size: 2.5rem; animation: heartbeat 1.5s ease-in-out infinite; display: inline-block; margin: 0 10px; }

.ouch-screen {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
  display: none; align-items: center; justify-content: center;
  z-index: 9999; flex-direction: column; color: white; text-align: center;
}

.final-message { font-size: 1.4rem; line-height: 1.8; margin-top: 1.5rem;
  background: rgba(255, 255, 255, 0.1); padding: 2rem; border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.celebration { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1000; display: none; }
.confetti { position: absolute; width: 10px; height: 10px; border-radius: 50%; top: -10px; animation: fall linear forwards; }
@keyframes fall {
  0%   { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}

.responses-display {
  position: fixed; bottom: 10px; right: 10px; background: rgba(0,0,0,0.8);
  color: white; padding: 15px; border-radius: 10px; font-size: 0.8rem;
  max-width: 300px; word-wrap: break-word; display: none;
}

.admin-toggle {
  position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.5);
  color: white; border: none; padding: 5px 10px; border-radius: 5px; font-size: 0.7rem; cursor: pointer;
}

.location-choice { margin: 1rem 0; }

@media (max-width: 400px) {
  .container { padding: 2rem 1rem; }
  .question { font-size: 1.2rem; }
}
</style>
</head>
<body>
<button class="admin-toggle" onclick="toggleResponses()">Show Responses</button>

<div class="container">
  <!-- Step 1: Name -->
  <div class="step active" id="step1">
    <div class="question">Hey, what's your name? ðŸ˜Š</div>
    <div class="input-container">
      <input type="text" id="nameInput" placeholder="Type your name here..." />
    </div>
    <button class="btn" onclick="handleNameSubmit()">Submit</button>
  </div>

  <!-- Step 1 Response -->
  <div class="step" id="step1-response">
    <div class="response-text">Yaay! It's you <span class="heart">ðŸ’•</span></div>
    <button class="btn" onclick="nextStep(2)">Continue</button>
  </div>

  <!-- Step 2: Date Question -->
  <div class="step" id="step2">
    <div class="question">Would you like to go out with me? ðŸ’–</div>
    <button class="btn yes" onclick="handleDateResponse('yes')">Yes ðŸ˜Š</button>
    <button class="btn no" onclick="handleDateResponse('no')">No, sorry ðŸ˜¢</button>
  </div>

  <!-- Step 3: Location Choice -->
  <div class="step" id="step3">
    <div class="response-text">Sorry, I've already chose Luga De Pool for you ðŸ¤£</div>
    <div class="location-choice">
      <button class="btn location" onclick="handleLocationChoice('Borrowdale')">Borrowdale</button>
      <button class="btn location" onclick="handleLocationChoice('Chisipite')">Chisipite</button>
    </div>
  </div>

  <!-- Step 4: Date and Time -->
  <div class="step" id="step4">
    <div class="question">Pick a date and time? ðŸ“…</div>
    <div class="input-container">
      <input type="datetime-local" id="dateTimeInput" />
    </div>
    <button class="btn" onclick="handleDateTimeSubmit()">Submit</button>
  </div>

  <!-- Step 5: Pickup Question -->
  <div class="step" id="step5">
    <div class="question">Would you like me to pick you up? ðŸš—</div>
    <button class="btn yes" onclick="handlePickupResponse('yes')">Yes</button>
    <button class="btn no" onclick="handlePickupResponse('no')">No</button>
  </div>

  <!-- Final Step -->
  <div class="step" id="final">
    <div class="response-text">Yaay! <span class="heart">ðŸ’•</span></div>
    <div class="final-message" id="finalMessage">
      Can't wait to see you on <span id="selectedDate"></span> around <span id="selectedTime"></span> ðŸ¤­
    </div>
  </div>
</div>

<!-- Ouch Screen -->
<div class="ouch-screen" id="ouchScreen">
  <div class="ouch-text">Ouch! ðŸ’”</div>
  <div style="font-size: 1.5rem; text-align: center;">
    Maybe next time... ðŸ˜¢<br>
    <small style="font-size: 1rem; margin-top: 1rem; display: block;">
      You can close this page now...
    </small>
  </div>
</div>

<!-- Celebration Effects -->
<div class="celebration" id="celebration"></div>

<!-- Admin Responses Display -->
<div class="responses-display" id="responsesDisplay">
  <strong>Responses Log:</strong><br>
  <div id="responsesList"></div>
</div>

<!-- Firebase + App Logic -->
<script type="module">
  // ==== Firebase (Realtime Database) ====
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD02K-GXsGR8EJ-_U0pVhJMJWeTzYiXfaY",
    authDomain: "dave-special-invitation.firebaseapp.com",
    databaseURL: "https://dave-special-invitation-default-rtdb.firebaseio.com",
    projectId: "dave-special-invitation",
    storageBucket: "dave-special-invitation.firebasestorage.app",
    messagingSenderId: "517002547365",
    appId: "1:517002547365:web:51a38ade950ce489e0fd4c",
    measurementId: "G-8MRGDQ3LPF"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ==== App State ====
  let responses = { name:'', wantsToDate:'', location:'', dateTime:'', needsPickup:'' };

  // ==== UI Helpers ====
  function updateResponsesDisplay() {
    const list = document.getElementById('responsesList');
    list.innerHTML = `
      Name: ${responses.name || ''}<br>
      Wants to date: ${responses.wantsToDate || ''}<br>
      Location: ${responses.location || ''}<br>
      Date/Time: ${responses.dateTime || ''}<br>
      Needs pickup: ${responses.needsPickup || ''}
    `;
  }

  // Expose for inline handlers
  window.toggleResponses = function toggleResponses() {
    const display = document.getElementById('responsesDisplay');
    display.style.display = (display.style.display === 'none' || !display.style.display) ? 'block' : 'none';
  }

  window.nextStep = function nextStep(stepNum) {
    document.querySelector('.step.active').classList.remove('active');
    document.getElementById(`step${stepNum}`).classList.add('active');
  }

  window.handleNameSubmit = function handleNameSubmit() {
    const nameInput = document.getElementById('nameInput');
    const name = nameInput.value.trim();
    if (!name) { alert('Please enter your name!'); return; }
    responses.name = name;
    updateResponsesDisplay();
    document.querySelector('.step.active').classList.remove('active');
    document.getElementById('step1-response').classList.add('active');
  }

  window.handleDateResponse = function handleDateResponse(response) {
    responses.wantsToDate = response;
    updateResponsesDisplay();
    if (response === 'no') {
      // No window.close() â€” just show message (works everywhere)
      document.getElementById('ouchScreen').style.display = 'flex';
      return;
    }
    nextStep(3);
  }

  window.handleLocationChoice = function handleLocationChoice(location) {
    responses.location = location;
    updateResponsesDisplay();
    nextStep(4);
  }

  window.handleDateTimeSubmit = function handleDateTimeSubmit() {
    const dateTimeInput = document.getElementById('dateTimeInput');
    const dateTime = dateTimeInput.value;
    if (!dateTime) { alert('Please select a date and time!'); return; }
    responses.dateTime = dateTime;
    updateResponsesDisplay();
    nextStep(5);
  }

  window.handlePickupResponse = async function handlePickupResponse(response) {
    responses.needsPickup = response;
    updateResponsesDisplay();

    // Prepare final message
    const selectedDateTime = new Date(responses.dateTime);
    const dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    const timeOptions = { hour: '2-digit', minute: '2-digit' };
    document.getElementById('selectedDate').textContent = selectedDateTime.toLocaleDateString('en-US', dateOptions);
    document.getElementById('selectedTime').textContent = selectedDateTime.toLocaleTimeString('en-US', timeOptions);

    // Switch to final screen
    document.querySelector('.step.active').classList.remove('active');
    document.getElementById('final').classList.add('active');

    // Save to Firebase
    try {
      const responsesRef = ref(db, 'responses');
      const newRef = push(responsesRef);
      await set(newRef, { ...responses, timestamp: new Date().toISOString() });
      console.log('Saved to Firebase âœ…');
    } catch (err) {
      console.error('Error saving to Firebase:', err);
    }

    // Celebration
    showCelebration();
  }

  function showCelebration() {
    const celebration = document.getElementById('celebration');
    celebration.style.display = 'block';
    for (let i = 0; i < 50; i++) setTimeout(createConfetti, i * 80);
    setTimeout(() => { celebration.style.display = 'none'; }, 5000);
  }

  function createConfetti() {
    const confetti = document.createElement('div');
    confetti.className = 'confetti';
    confetti.style.left = Math.random() * 100 + '%';
    confetti.style.backgroundColor = getRandomColor();
    confetti.style.animationDelay = Math.random() * 0.5 + 's';
    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
    document.getElementById('celebration').appendChild(confetti);
    setTimeout(() => confetti.remove(), 5000);
  }

  function getRandomColor() {
    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#6c5ce7', '#a29bfe', '#fd79a8', '#e84393'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  // Set minimum date to now
  document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    const year = now.getFullYear();
    const month = String(now.getMonth() + 1).padStart(2, '0');
    const day = String(now.getDate()).padStart(2, '0');
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    document.getElementById('dateTimeInput').min = `${year}-${month}-${day}T${hours}:${minutes}`;
  });

  // Use keydown (keypress is deprecated in some browsers)
  document.getElementById('nameInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') handleNameSubmit();
  });
  document.getElementById('dateTimeInput').addEventListener('keydown', function(e) {
    if (e.key === 'Enter') handleDateTimeSubmit();
  });
</script>
</body>
</html>